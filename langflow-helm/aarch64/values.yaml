imagePullSecrets: []

nameOverride: "langflow"
# Override for the name of the helm deployment
# Note: using `langflow` as service name causes
# env var collision when deploying on openshift
# https://github.com/langflow-ai/langflow/issues/4330#issuecomment-2459097917
# Using "langflow-app" to avoid collision while keeping it clean
fullnameOverride: "langflow-app"

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the
  # fullname template
  name: ""

ingress:
  enabled: false
  className: nginx
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: langflow.64bit.kr
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local

securityContext:
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000
  allowPrivilegeEscalation: false
  runAsGroup: 1000

podSecurityContext:
  fsGroup: 1000
  runAsUser: 1000
  runAsNonRoot: true
  runAsGroup: 1000


langflow:
  global:
    image:
      tag: "aarch64"
  backend:
    replicaCount: 1
    service:
      type: ClusterIP
      port: 7860
    backendOnly: false
    numWorkers: 1
    image:
      repository: bahn1075/langflow-custom
      imagePullPolicy: IfNotPresent
      tag: aarch64
    command:
      - python
      - -m
      - langflow
      - run
      - --host
      - "0.0.0.0"
    resources:
      requests:
        cpu: 0.2
        memory: 1Gi
      # limits:
      #   cpu: 0.5
      #   memory: 1Gi
    probe:
      failureThreshold: 10
      periodSeconds: 10
      timeoutSeconds: 10
      initialDelaySeconds: 60
    env:
      - name: LANGFLOW_PORT
        value: "7860"
      - name: LANGFLOW_ALEMBIC_LOG_FILE
        value: "/app/db/alembic.log"
      - name: LANGFLOW_UPDATE_STARTER_PROJECTS
        value: "false"
      - name: LANGFLOW_MAX_FILE_SIZE_UPLOAD
        value: "100"  # 100MB
      - name: LANGFLOW_AUTO_LOGIN
        value: "false"
      - name: LANGFLOW_SUPERUSER
        value: "admin"
      - name: LANGFLOW_SUPERUSER_PASSWORD
        value: "admin123"
      - name: LANGFLOW_NEW_USER_IS_ACTIVE
        value: "false"
      - name: PHOENIX_API_KEY
        valueFrom:
          secretKeyRef:
            name: phoenix-secret
            key: PHOENIX_API_KEY
      - name: OTEL_EXPORTER_OTLP_HEADERS
        valueFrom:
          secretKeyRef:
            name: phoenix-secret
            key: OTEL_EXPORTER_OTLP_HEADERS
      - name: PHOENIX_COLLECTOR_ENDPOINT
        valueFrom:
          secretKeyRef:
            name: phoenix-secret
            key: PHOENIX_COLLECTOR_ENDPOINT
      - name: OTEL_EXPORTER_OTLP_ENDPOINT
        valueFrom:
          secretKeyRef:
            name: phoenix-secret
            key: OTEL_EXPORTER_OTLP_ENDPOINT
    nodeSelector: {}
    tolerations: []
    affinity: {}
    podAnnotations:
      prometheus.io/scrape: "true"
      prometheus.io/port: 9090
      prometheus.io/path: "/metrics"

    securityContext:
      capabilities:
        drop:
          - ALL
      readOnlyRootFilesystem: true
      runAsNonRoot: true
      runAsUser: 1000
      allowPrivilegeEscalation: false
      runAsGroup: 1000

    podSecurityContext:
      fsGroup: 1000
      runAsUser: 1000
      runAsNonRoot: true
      runAsGroup: 1000

    externalDatabase:
      # Compose in the SQLAlchemy format:
      # https://docs.sqlalchemy.org/en/20/core/engines.html#database-urls
      enabled: true
      driver:
        value: "postgresql+psycopg"
      host:
        value: "postgres-postgresql.postgres.svc.cluster.local"
      port:
        value: "5432"
      user:
        value: "postgres"
      password:
        value: "postgres123"
      database:
        value: "postgres"

    volumes:
      - name: flows
        emptyDir: {}
      - name: tmp
        emptyDir: {}
      - name: data
        emptyDir: {}
      - name: db
        emptyDir: {}

    volumeMounts:
      - name: flows
        mountPath: /app/flows
        readOnly: false
      - name: tmp
        mountPath: /tmp
        readOnly: false
      - name: data
        mountPath: /app/data
        readOnly: false
      - name: db
        mountPath: /app/db
        readOnly: false

    sqlite:
      enabled: false

  frontend:
    enabled: false

    # autoLogin: true|false
    # superuser: <superuser login>
    # superuserPassword: <superuser password>
    # secretKey: <encryption key, optional>
    # newUserIsActive: true|false


secretProvider:
  enabled: false

postgresql:
  enabled: false
